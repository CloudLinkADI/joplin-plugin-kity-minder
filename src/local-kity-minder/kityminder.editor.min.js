(function(){function e(e){t.r([n[e]])}var t={r:function(e){if(t[e].inited)return t[e].value;if("function"!=typeof t[e].value)return t[e].inited=!0,t[e].value;var n={exports:{}},i=t[e].value(null,n.exports,n);if(t[e].inited=!0,t[e].value=i,void 0!==i)return i;for(var r in n.exports)if(n.exports.hasOwnProperty(r))return t[e].inited=!0,t[e].value=n.exports,n.exports}};t[0]={value:function(e,n,i){function r(e){a.push(e)}function o(e){this.selector=e;for(var t=0;t<a.length;t++)"function"==typeof a[t]&&a[t].call(this,this)}var a=[];return o.assemble=r,r(t.r(7)),r(t.r(9)),r(t.r(14)),r(t.r(18)),r(t.r(11)),r(t.r(12)),r(t.r(5)),r(t.r(6)),r(t.r(8)),r(t.r(15)),r(t.r(10)),r(t.r(13)),r(t.r(16)),r(t.r(17)),i.exports=o}},t[1]={value:function(e,n,i){return i.exports=kityminder.Editor=t.r(0)}},t[2]={value:function(e,t,n){return n.exports=window.HotBox}},t[3]={value:function(e,t,n){}},t[4]={value:function(e,t,n){return n.exports=window.kityminder.Minder}},t[5]={value:function(e,t,n){function i(){function e(e,n){if(!this.isPureText(n)){var i=this.whichMimeType(n);if(!i)throw new Error("unknow mimetype!");n=this.getPureText(n)}return!1===e?n:e+t+n}var t="\ufeff",n={"application/km":"￿"},i={"\ufeff":"SPLITOR","￿":"application/km"};this.registMimeTypeProtocol=function(e,t){if(t&&i[t])throw new Error("sing has registed!");if(e&&n[e])throw new Error("mimetype has registed!");i[t]=e,n[e]=t},this.getMimeTypeProtocol=function(t,i){var r=n[t]||!1;return void 0===i?e.bind(this,r):e(r,i)},this.getSpitor=function(){return t},this.getMimeType=function(e){return void 0!==e?i[e]||null:n}}function r(){this.minder.supportClipboardEvent&&!kity.Browser.gecko&&(this.MimeType=new i)}return i.prototype.isPureText=function(e){return!~e.indexOf(this.getSpitor())},i.prototype.getPureText=function(e){return this.isPureText(e)?e:e.split(this.getSpitor())[1]},i.prototype.whichMimeType=function(e){return this.isPureText(e)?null:this.getMimeType(e.split(this.getSpitor())[0])},n.exports=r}},t[6]={value:function(e,t,n){function i(){function e(e){for(var i=[],r=0,o=e.length;r<o;r++)i.push(t.exportNode(e[r]));return a(n.getRegisterProtocol("json").encode(i))}var t=this.minder,n=window.kityminder.data;if(t.supportClipboardEvent&&!kity.Browser.gecko){var i=this.fsm,r=this.receiver,o=this.MimeType,a=o.getMimeTypeProtocol("application/km"),l=n.getRegisterProtocol("json").decode,c=[],d=function(n){if(document.activeElement==r.element){var o=n,a=i.state();switch(a){case"input":break;case"normal":var l=[].concat(t.getSelectedNodes());if(l.length){var c;if(l.length>1)if(l.sort(function(e,t){return e.getLevel()-t.getLevel()}),c=l[0].getLevel(),c!==l[l.length-1].getLevel()){var d,s=0,u=l.length,m=u-1;for(d=l[m];d.getLevel()!==c;){for(s=0;s<u&&l[s].getLevel()===c;){if(l[s].isAncestorOf(d)){l.splice(m,1);break}s++}m--,d=l[m]}}var p=e(l);o.clipboardData.setData("text/plain",p)}n.preventDefault()}}},s=function(n){if(document.activeElement==r.element){if("normal"!==t.getStatus())return void n.preventDefault();var o=n,a=i.state();switch(a){case"input":break;case"normal":var l=t.getSelectedNodes();l.length&&(o.clipboardData.setData("text/plain",e(l)),t.execCommand("removenode")),n.preventDefault()}}},u=function(e){if(document.activeElement==r.element){if("normal"!==t.getStatus())return void e.preventDefault();var n=e,a=i.state(),d=n.clipboardData.getData("text/plain");switch(a){case"input":if(!o.isPureText(d))return void e.preventDefault();break;case"normal":var s=t.getSelectedNodes();if("application/km"===o.whichMimeType(d)){var u,m=l(o.getPureText(d));s.forEach(function(e){for(var n=m.length-1;n>=0;n--)u=t.createNode(null,e),t.importNode(u,m[n]),c.push(u),e.appendChild(u)}),t.select(c,!0),c=[],t.refresh()}else{if(n.clipboardData&&n.clipboardData.items[0].type.indexOf("image")>-1){var p=n.clipboardData.items[0].getAsFile(),g=angular.element(document.body).injector().get("server");return g.uploadImage(p).then(function(e){var n=e.data;0===n.errno&&t.execCommand("image",n.data.url)})}s.forEach(function(e){t.Text2Children(e,d)})}e.preventDefault()}}};document.addEventListener("copy",d),document.addEventListener("cut",s),document.addEventListener("paste",u)}}return n.exports=i}},t[7]={value:function(e,t,n){function i(){var e;if(e="string"==typeof this.selector?document.querySelector(this.selector):this.selector,!e)throw new Error("Invalid selector: "+this.selector);e.classList.add("km-editor"),this.container=e}return n.exports=i}},t[8]={value:function(e,n,i){function r(){function e(){r.when("* -> drag",function(){}),r.when("drag -> *",function(e,t,n){})}function t(e,t){if(!e)return y=k=!1,g&&kity.releaseFrame(g),void(g=null);g||(g=kity.requestFrame(function(e,t,n){return function(i){switch(e){case"left":n._viewDragger.move({x:-t,y:0},0);break;case"top":n._viewDragger.move({x:0,y:-t},0);break;case"right":n._viewDragger.move({x:t,y:0},0);break;case"bottom":n._viewDragger.move({x:0,y:t},0);break;default:return}i.next()}}(e,t,a)))}var n,i,r=this.fsm,a=this.minder,l=this.hotbox,c=this.receiver;c.element;e();var d,s,u,m,p,g,f=0,v=1,h=20,b=v,y=!1,k=!1;a.on("mousedown",function(e){b=f;var t=a.getPaper().container.getBoundingClientRect();n=e.originEvent.clientX,i=e.originEvent.clientY,p=t.top,d=t.width,s=t.height}),a.on("mousemove",function(e){if("drag"===r.state()&&b==f&&a.getSelectedNode()&&(Math.abs(n-e.originEvent.clientX)>h||Math.abs(i-e.originEvent.clientY)>h)&&(u=e.originEvent.clientX,m=e.originEvent.clientY-p,u<h?t("right",h-u):u>d-h?t("left",h+u-d):y=!0,m<h?t("bottom",m):m>s-h?t("top",h+m-s):k=!0,y&&k&&t(!1)),"drag"!==r.state()&&b===f&&a.getSelectedNode()&&(Math.abs(n-e.originEvent.clientX)>h||Math.abs(i-e.originEvent.clientY)>h))return"hotbox"===r.state()&&l.active(o.STATE_IDLE),r.jump("drag","user-drag")}),window.addEventListener("mouseup",function(){if(b=v,"drag"===r.state())return t(!1),r.jump("normal","drag-finish")},!1)}var o=t.r(2),a=t.r(19);new a("drag");return i.exports=r}},t[9]={value:function(e,n,i){function r(e,t,n,i){return e.when==t&&(("*"==e.enter||e.enter==i)&&("*"==e.exit||e.exit==n||void 0))}function o(e){var t=e,n=" - ",i=" -> ",o=[];this.jump=function(e,n){if(!n)throw new Error("Please tell fsm the reason to jump");var i,a,l=t,d=[l,e].concat([].slice.call(arguments,1));for(i=0;i<o.length;i++)if(a=o[i],r(a.condition,"before",l,e)&&a.apply(null,d))return;for(t=e,c.log("[{0}] {1} -> {2}",n,l,e),i=0;i<o.length;i++)a=o[i],r(a.condition,"after",l,e)&&a.apply(null,d);return t},this.state=function(){return t},this.when=function(e,t){var r,a,l,c;if(1==arguments.length&&(t=e,e="* -> *"),a=e.split(n),2==a.length?r="before":(a=e.split(i),2==a.length&&(r="after")),!r)throw new Error("Illegal fsm condition: "+e);l=a[0],c=a[1],t.condition={when:r,exit:l,enter:c},o.push(t)}}function a(){this.fsm=new o("normal")}var l=t.r(19),c=new l("fsm");return i.exports=a}},t[10]={value:function(e,n,i){function r(){function e(){m=[],p=[],s=g.exportJson()}function t(){var e=g.exportJson(),t=o(e,s);if(t.length){for(m.push(t);m.length>v;)m.shift();return s=e,!0}}function n(){var e=g.exportJson();p.push(o(e,s)),s=e}function i(){u=!0;var e=m.pop();e&&(g.applyPatches(e),n()),u=!1}function r(){u=!0;var e=p.pop();e&&(g.applyPatches(e),t()),u=!1}function a(){u||t()&&(p=[])}function l(){return!!m.length}function c(){return!!p.length}function d(e){if(u){var t=e.patch;switch(t.express){case"node.add":g.select(t.node.getChild(t.index),!0);break;case"node.remove":case"data.replace":case"data.remove":case"data.add":g.select(t.node,!0)}}}var s,u,m,p,g=this.minder,f=this.hotbox,v=100;this.history={reset:e,undo:i,redo:r,hasUndo:l,hasRedo:c},e(),g.on("contentchange",a),g.on("import",e),g.on("patch",d);var h=f.state("main");h.button({position:"top",label:_lang_pack[_lang_default].hotbox.undo,key:"Ctrl + Z",enable:l,action:i,next:"idle"}),h.button({position:"top",label:_lang_pack[_lang_default].hotbox.redo,key:"Ctrl + Y",enable:c,action:r,next:"idle"})}var o=t.r(22);return window.diff=o,i.exports=r}},t[11]={value:function(e,n,i){function r(){var e=this.fsm,t=this.minder,n=this.receiver,i=this.container,r=new o(i);r.setParentFSM(e),e.when("normal -> hotbox",function(e,n,i){var o,a=t.getSelectedNode();if(a){var l=a.getRenderBox();o={x:l.cx,y:l.cy}}r.active("main",o)}),e.when("normal -> normal",function(e,n,i,o){if("shortcut-handle"==i){var a=r.dispatch(o);a?o.preventDefault():t.dispatchKeyEvent(o)}}),e.when("modal -> normal",function(e,t,i,r){"import-text-finish"==i&&n.element.focus()}),this.hotbox=r}var o=t.r(2);return i.exports=r}},t[12]={value:function(e,n,i){function r(){function e(){u.when("* -> input",r),u.when("input -> *",function(e,t,n){switch(n){case"input-cancel":return d();case"input-commit":default:return c()}}),g.onblur(function(e){"input"==u.state()&&u.jump("normal","input-commit")}),m.on("beforemousedown",function(){"input"==u.state()&&u.jump("normal","input-commit")}),m.on("dblclick",function(){m.getSelectedNode()&&"readonly"!==m._status&&i()})}function t(){a.flaged&&f.classList.add("debug"),f.onmousedown=function(e){e.stopPropagation()},m.on("layoutallfinish viewchange viewchanged selectionchange",function(e){"viewchange"==e.type&&"input"!=u.state()||s()}),s()}function n(){p.state("main").button({position:"center",label:_lang_pack[_lang_default].hotbox.editnode,key:"F2",enable:function(){return-1!=m.queryCommandState("text")},action:i})}function i(){var e=m.getSelectedNode();if(e){var t=f;if(f.innerText="","bold"===e.getData("font-weight")){var n=document.createElement("b");t.appendChild(n),t=n}if("italic"===e.getData("font-style")){var i=document.createElement("i");t.appendChild(i),t=i}t.innerText=m.queryCommandValue("text"),v&&g.fixFFCaretDisappeared(),u.jump("input","input-request"),g.selectAll()}}function r(){var e=m.getSelectedNode();if(e){var t=e.getData("font-size")||e.getStyle("font-size");f.style.fontSize=t+"px",f.style.minWidth=0,f.style.minWidth=f.clientWidth+"px",f.style.fontWeight=e.getData("font-weight")||"",f.style.fontStyle=e.getData("font-style")||"",f.classList.add("input"),f.focus()}}function o(e){for(var t,n,i,r="",o="\t",a="\n",l=/\S/,c=" ",s=new RegExp("( |"+String.fromCharCode(160)+")"),u=document.createElement("br"),p=!1,g=!1,f=0,v=e.length;f<v;f++)switch(t=e[f],Object.prototype.toString.call(t)){case"[object HTMLBRElement]":r+=a;break;case"[object Text]":if(t=t.textContent.replace("&nbsp;"," "),l.test(t))r+=t;else for(i=t.length;i--;)s.test(t[i])?r+=c:t[i]===o&&(r+=o);break;case"[object HTMLElement]":switch(t.nodeName){case"B":p=!0;break;case"I":g=!0}[].splice.apply(e,[f,1].concat([].slice.call(t.childNodes))),v=e.length,f--;break;case"[object HTMLSpanElement]":[].splice.apply(e,[f,1].concat([].slice.call(t.childNodes))),v=e.length,f--;break;case"[object HTMLImageElement]":t.src&&/http(|s):\/\//.test(t.src)&&m.execCommand("Image",t.src,t.alt);break;case"[object HTMLDivElement]":n=[];var h=0;for(v=t.childNodes.length;h<v;h++)n.push(t.childNodes[h]);n.push(u),[].splice.apply(e,[f,1].concat(n)),v=e.length,f--;break;default:if(t&&t.childNodes.length){n=[];for(h=0,v=t.childNodes.length;h<v;h++)n.push(t.childNodes[h]);n.push(u),[].splice.apply(e,[f,1].concat(n)),v=e.length,f--}else t&&void 0!==t.textContent?r+=t.textContent:r+=""}return r=r.replace(/^\n*|\n*$/g,""),r=r.replace(new RegExp("(\n|\r|\n\r)( |"+String.fromCharCode(160)+"){4}","g"),"$1\t"),m.getSelectedNode().setText(r),p?m.queryCommandState("bold")||m.execCommand("bold"):m.queryCommandState("bold")&&m.execCommand("bold"),g?m.queryCommandState("italic")||m.execCommand("italic"):m.queryCommandState("italic")&&m.execCommand("italic"),d(),r}function l(e,t){try{m.decodeData("text",t).then(function(t){function n(e,t,i){var r=t.data;e.setText(r.text||"");for(var o=t.children||[],a=0;a<o.length;a++){var l=i.createNode(null,e);n(l,o[a],i)}return e}n(e,t,m),m.fire("contentchange"),m.getRoot().renderTree(),m.layout(300)})}catch(e){if(m.fire("contentchange"),m.getRoot().renderTree(),"Error: Invalid local format"!==e.toString())throw e}}function c(){var e=[].slice.call(f.childNodes);setTimeout(function(){f.innerHTML=""},0);var t=m.getSelectedNode();if(e=o(e),l(t,e),"root"==t.type){var n=m.getRoot().getText();m.fire("initChangeRoot",{text:n})}}function d(){f.classList.remove("input"),g.selectAll()}function s(){var e=s,t=m.getSelectedNode();t&&(e.timer||(e.timer=setTimeout(function(){var n=t.getRenderBox("TextRenderer");f.style.left=Math.round(n.x)+"px",f.style.top=(a.flaged?Math.round(n.bottom+30):Math.round(n.y))+"px",e.timer=0})))}var u=this.fsm,m=this.minder,p=this.hotbox,g=this.receiver,f=g.element,v=window.kity.Browser.gecko;t(),e(),n(),this.editText=i}t.r(21);var o=t.r(19),a=new o("input");return i.exports=r}},t[13]={value:function(e,n,i){function r(e){return!(e.ctrlKey||e.metaKey||e.altKey)&&(e.keyCode>=65&&e.keyCode<=90||(e.keyCode>=48&&e.keyCode<=57||(108!=e.keyCode&&e.keyCode>=96&&e.keyCode<=111||(108!=e.keyCode&&e.keyCode>=96&&e.keyCode<=111||(229==e.keyCode||0===e.keyCode)))))}function o(){var e,t,n=this.fsm,i=this.minder,o=this.receiver,l=this.container,c=o.element,d=this.hotbox,s=!1;o.listen("normal",function(e){if(o.enable(),e.is("Space"))return e.preventDefault(),kity.Browser.safari&&(c.innerHTML=""),n.jump("hotbox","space-trigger");switch(e.type){case"keydown":if(i.getSelectedNode()){if(r(e))return n.jump("input","user-input")}else c.innerHTML="";n.jump("normal","shortcut-handle",e)}}),o.listen("hotbox",function(e){o.disable(),e.preventDefault();d.dispatch(e);if(d.state()==a.STATE_IDLE&&"hotbox"==n.state())return n.jump("normal","hotbox-idle")}),o.listen("input",function(e){if(o.enable(),"keydown"==e.type){if(e.is("Enter"))return e.preventDefault(),n.jump("normal","input-commit");if(e.is("Esc"))return e.preventDefault(),n.jump("normal","input-cancel");(e.is("Tab")||e.is("Shift + Tab"))&&e.preventDefault()}else if("keyup"==e.type&&e.is("Esc")){if(e.preventDefault(),!s)return n.jump("normal","input-cancel")}else"compositionstart"==e.type?s=!0:"compositionend"==e.type&&setTimeout(function(){s=!1})});var u=2;l.addEventListener("mousedown",function(i){i.button==u&&i.preventDefault(),"hotbox"==n.state()?(d.active(a.STATE_IDLE),n.jump("normal","blur")):"normal"==n.state()&&i.button==u&&(e=i.clientX,t=i.clientY)},!1),l.addEventListener("mousewheel",function(e){"hotbox"==n.state()&&(d.active(a.STATE_IDLE),n.jump("normal","mousemove-blur"))},!1),l.addEventListener("contextmenu",function(e){e.preventDefault()}),l.addEventListener("mouseup",function(r){"normal"==n.state()&&r.button==u&&r.clientX==e&&r.clientY==t&&i.getSelectedNode()&&n.jump("hotbox","content-menu")},!1),d.$element.addEventListener("mousedown",function(e){e.stopPropagation()})}var a=t.r(2);return i.exports=o}},t[14]={value:function(e,n,i){function r(){var e=new o({enableKeyReceiver:!1,enableAnimation:!0});e.renderTo(this.selector),e.setTheme(null),e.select(e.getRoot(),!0),e.execCommand("text",_lang_pack[_lang_default].maintopic),this.minder=e}var o=t.r(4);return i.exports=r}},t[15]={value:function(e,t,n){function i(){function e(){i.fire("importNodeData")}function t(){i.fire("exportNodeData")}var n=this,i=this.minder,r=this.hotbox,o=this.fsm,a=r.state("main"),l=[_lang_pack[_lang_default].hotbox.arrangeup+":Alt+Up:ArrangeUp",_lang_pack[_lang_default].hotbox.appendchildnode+":Tab|Insert:AppendChildNode",_lang_pack[_lang_default].hotbox.appendsiblingnode+":Enter:AppendSiblingNode",_lang_pack[_lang_default].hotbox.arrangedown+":Alt+Down:ArrangeDown",_lang_pack[_lang_default].hotbox.remove+":Delete|Backspace:RemoveNode",_lang_pack[_lang_default].hotbox.appendparentnode+":Shift+Tab|Shift+Insert:AppendParentNode"],c=0;l.forEach(function(e){var t=e.split(":"),r=t.shift(),l=t.shift(),d=t.shift();a.button({position:"ring",label:r,key:l,action:function(){if(0===d.indexOf("Append")){function e(){--c||n.editText(),i.off("layoutallfinish",e)}c++,i.execCommand(d,_lang_pack[_lang_default].topic),i.on("layoutallfinish",e)}else i.execCommand(d),o.jump("normal","command-executed")},enable:function(){return-1!=i.queryCommandState(d)}})}),a.button({position:"bottom",label:_lang_pack[_lang_default].hotbox.importnode,key:"Alt + V",enable:function(){var e=i.getSelectedNodes();return 1==e.length},action:e,next:"idle"}),a.button({position:"bottom",label:_lang_pack[_lang_default].hotbox.exportnode,key:"Alt + C",enable:function(){var e=i.getSelectedNodes();return 1==e.length},action:t,next:"idle"})}return n.exports=i}},t[16]={value:function(e,t,n){function i(){var e=this.minder,t=this.hotbox,n=t.state("main");n.button({position:"top",label:_lang_pack[_lang_default].hotbox.priority,key:"P",next:"priority",enable:function(){return-1!=e.queryCommandState("priority")}});var i=t.state("priority");"123456789".replace(/./g,function(t){i.button({position:"ring",label:"P"+t,key:t,action:function(){e.execCommand("Priority",t)}})}),i.button({position:"center",label:_lang_pack[_lang_default].hotbox.remove,key:"Del",action:function(){e.execCommand("Priority",0)}}),i.button({position:"top",label:"返回",key:"esc",next:"back"})}return n.exports=i}},t[17]={value:function(e,t,n){function i(){var e=this.minder,t=this.hotbox,n=t.state("main");n.button({position:"top",label:_lang_pack[_lang_default].hotbox.progress,key:"G",next:"progress",enable:function(){return-1!=e.queryCommandState("progress")}});var i=t.state("progress");"012345678".replace(/./g,function(t){i.button({position:"ring",label:"G"+t,key:t,action:function(){e.execCommand("Progress",parseInt(t)+1)}})}),i.button({position:"center",label:_lang_pack[_lang_default].hotbox.remove,key:"Del",action:function(){e.execCommand("Progress",0)}}),i.button({position:"top",label:"返回",key:"esc",next:"back"})}return n.exports=i}},t[18]={value:function(e,n,i){function r(){function e(e){var n;e.is=function(e){for(var t=e.split("|"),n=0;n<t.length;n++)if(o.is(this,t[n]))return!0;return!1};for(var i=0;i<a.length;i++)if(n=a[i],("*"==n.notifyState||n.notifyState==t.state())&&n.call(null,e))return}var t=this.fsm,n=this.minder,i=document.createElement("div");i.contentEditable=!0,i.setAttribute("tabindex",-1),i.classList.add("receiver"),i.onkeydown=i.onkeypress=i.onkeyup=e,i.addEventListener("compositionstart",e),this.container.appendChild(i);var r={element:i,selectAll:function(){i.innerHTML||(i.innerHTML="&nbsp;");var e=document.createRange(),t=window.getSelection();e.selectNodeContents(i),t.removeAllRanges(),t.addRange(e),i.focus()},enable:function(){i.setAttribute("contenteditable",!0)},disable:function(){i.setAttribute("contenteditable",!1)},fixFFCaretDisappeared:function(){i.removeAttribute("contenteditable"),i.setAttribute("contenteditable","true"),i.blur(),i.focus()},onblur:function(e){i.onblur=e}};r.selectAll(),n.on("beforemousedown",r.selectAll),n.on("receiverfocus",r.selectAll),n.on("readonly",function(){n.disable(),editor.receiver.element.parentElement.removeChild(editor.receiver.element),editor.hotbox.$container.removeChild(editor.hotbox.$element)});var a=[];r.listen=function(e,t){1==arguments.length&&(t=e,e="*"),t.notifyState=e,a.push(t)},this.receiver=r}var o=t.r(23);t.r(2);return i.exports=r}},t[19]={value:function(e,n,i){function r(){}function o(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);return t}function a(e){var t=this.flaged=-1!=window.location.search.indexOf(e);if(t){var n=o(e)%360,i=l("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",n),a="background: none; color: black;";this.log=function(){var t=l.apply(null,arguments);console.log(l("%c{0}%c{1}",e,t),i,a)}}else this.log=r}var l=t.r(20);return i.exports=a}},t[20]={value:function(e,t,n){function i(e,t){return"object"!=typeof t&&(t=[].slice.call(arguments,1)),String(e).replace(/\{(\w+)\}/gi,function(e,n){return t[n]||n})}return n.exports=i}},t[21]={value:function(e,t,n){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",function(){var e,t,n=window.getSelection(),i=[];for(t=0;t<n.rangeCount;t++)i[t]=n.getRangeAt(t);for(n.removeAllRanges(),n.selectAllChildren(this),e=n.toString(),n.removeAllRanges(),t=0;t<i.length;t++)n.addRange(i[t]);return e}),HTMLElement.prototype.__defineSetter__("innerText",function(e){this.innerHTML=(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}))}},t[22]={value:function(e,t,n){function i(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function r(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function o(e,t,n,a){for(var c=l(t),d=l(e),s=!1,u=d.length-1;u>=0;u--){var m=d[u],p=e[m];if(t.hasOwnProperty(m)){var g=t[m];"object"==typeof p&&null!=p&&"object"==typeof g&&null!=g?o(p,g,n,a+"/"+i(m)):p!=g&&(!0,n.push({op:"replace",path:a+"/"+i(m),value:r(g)}))}else n.push({op:"remove",path:a+"/"+i(m)}),s=!0}if(s||c.length!=d.length)for(u=0;u<c.length;u++){m=c[u];e.hasOwnProperty(m)||n.push({op:"add",path:a+"/"+i(m),value:r(t[m])})}}function a(e,t){var n=[];return o(e,t,n,""),n}var l=Object.keys?Object.keys:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};return n.exports=a}},t[23]={value:function(e,n,i){function r(e){return"string"==typeof e?l(e):a(e)}function o(e,t){return e&&t&&r(e)==r(t)}function a(e){var t=0;if((e.ctrlKey||e.metaKey)&&(t|=d),e.altKey&&(t|=s),e.shiftKey&&(t|=u),-1===[16,17,18,91].indexOf(e.keyCode)){if(229===e.keyCode&&e.keyIdentifier)return t|parseInt(e.keyIdentifier.substr(2),16);t|=e.keyCode}return t}function l(e){var t=0;return e.toLowerCase().split(/\s*\+\s*/).forEach(function(e){switch(e){case"ctrl":case"cmd":t|=d;break;case"alt":t|=s;break;case"shift":t|=u;break;default:t|=c[e]}}),t}var c=t.r(24),d=4096,s=8192,u=16384;n.hash=r,n.is=o}},t[24]={value:function(e,t,n){var i={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var r in i)i.hasOwnProperty(r)&&(i[r.toLowerCase()]=i[r]);var o=65,a="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(e){i[e]=o+(e.charCodeAt(0)-a)});var l=9;do{i[l.toString()]=l+48}while(--l);n.exports=i}};var n={"expose-editor":1};angular.module("kityminderEditor",["ui.bootstrap","ui.codemirror","ui.colorpicker"]).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://agroup.baidu.com:8910/**","http://cq01-fe-rdtest01.vm.baidu.com:8910/**","http://agroup.baidu.com:8911/**"])}]),angular.module("kityminderEditor").run(["$templateCache",function(e){"use strict";e.put("ui/directive/appendNode/appendNode.html","<div class=\"km-btn-group append-group\"><div class=\"km-btn-item append-child-node\" ng-disabled=\"minder.queryCommandState('AppendChildNode') === -1\" ng-click=\"minder.queryCommandState('AppendChildNode') === -1 || execCommand('AppendChildNode')\" title=\"{{ 'appendchildnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendchildnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item append-parent-node\" ng-disabled=\"minder.queryCommandState('AppendParentNode') === -1\" ng-click=\"minder.queryCommandState('AppendParentNode') === -1 || execCommand('AppendParentNode')\" title=\"{{ 'appendparentnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendparentnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item append-sibling-node\" ng-disabled=\"minder.queryCommandState('AppendSiblingNode') === -1\" ng-click=\"minder.queryCommandState('AppendSiblingNode') === -1 ||execCommand('AppendSiblingNode')\" title=\"{{ 'appendsiblingnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendsiblingnode' | lang:'ui/command' }}</span></div></div>"),e.put("ui/directive/arrange/arrange.html","<div class=\"km-btn-group arrange-group\"><div class=\"km-btn-item arrange-up\" ng-disabled=\"minder.queryCommandState('ArrangeUp') === -1\" ng-click=\"minder.queryCommandState('ArrangeUp') === -1 || minder.execCommand('ArrangeUp')\" title=\"{{ 'arrangeup' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'arrangeup' | lang:'ui/command' }}</span></div><div class=\"km-btn-item arrange-down\" ng-disabled=\"minder.queryCommandState('ArrangeDown') === -1\" ng-click=\"minder.queryCommandState('ArrangeDown') === -1 || minder.execCommand('ArrangeDown');\" title=\"{{ 'arrangedown' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'arrangedown' | lang:'ui/command' }}</span></div></div>"),e.put("ui/directive/colorPanel/colorPanel.html",'<div class="bg-color-wrap"><span class="quick-bg-color" ng-click="minder.queryCommandState(\'background\') === -1 || minder.execCommand(\'background\', bgColor)" ng-disabled="minder.queryCommandState(\'background\') === -1"></span> <span color-picker class="bg-color" set-color="setDefaultBg()" ng-disabled="minder.queryCommandState(\'background\') === -1"><span class="caret"></span></span> <span class="bg-color-preview" ng-style="{ \'background-color\': bgColor }" ng-click="minder.queryCommandState(\'background\') === -1 || minder.execCommand(\'background\', bgColor)" ng-disabled="minder.queryCommandState(\'background\') === -1"></span></div>'),e.put("ui/directive/expandLevel/expandLevel.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default expand" title="{{ \'expandtoleaf\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="minder.execCommand(\'ExpandToLevel\', 9999)"></button> <button type="button" class="btn btn-default expand-caption dropdown-toggle" title="{{ \'expandtoleaf\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'expandtoleaf\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'expandtoleaf\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="level in levels"><a href ng-click="minder.execCommand(\'ExpandToLevel\', level)">{{ \'expandtolevel\' + level | lang:\'ui/command\' }}</a></li></ul></div>'),e.put("ui/directive/fontOperator/fontOperator.html",'<div class="font-operator"><div class="dropdown font-family-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontfamily\') === -1"><a href class="current-font-family" title="{{ \'fontfamily\' | lang: \'ui\' }}">{{ getFontfamilyName(minder.queryCommandValue(\'fontfamily\')) }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontFamilyList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontfamily\', f.val)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontfamily\') }" ng-style="{\'font-family\': f.val }">{{ f.name }}</a></li></ul></div><div class="dropdown font-size-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontsize\') === -1"><a href class="current-font-size" title="{{ \'fontsize\' | lang: \'ui\' }}">{{ getFontSize(minder.queryCommandValue(\'fontsize\')) }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontSizeList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontsize\', f)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontsize\') }" ng-style="{\'font-size\': f + \'px\'}">{{ f }}</a></li></ul></div><span class="s-btn-icon font-bold" ng-click="minder.queryCommandState(\'bold\') === -1 || minder.execCommand(\'bold\')" ng-class="{\'font-bold-selected\' : minder.queryCommandState(\'bold\') == 1}" ng-disabled="minder.queryCommandState(\'bold\') === -1"></span> <span class="s-btn-icon font-italics" ng-click="minder.queryCommandState(\'italic\') === -1 || minder.execCommand(\'italic\')" ng-class="{\'font-italics-selected\' : minder.queryCommandState(\'italic\') == 1}" ng-disabled="minder.queryCommandState(\'italic\') === -1"></span><div class="font-color-wrap"><span class="quick-font-color" ng-click="minder.queryCommandState(\'forecolor\') === -1 || minder.execCommand(\'forecolor\', foreColor)" ng-disabled="minder.queryCommandState(\'forecolor\') === -1">A</span> <span color-picker class="font-color" set-color="setDefaultColor()" ng-disabled="minder.queryCommandState(\'forecolor\') === -1"><span class="caret"></span></span> <span class="font-color-preview" ng-style="{ \'background-color\': foreColor }" ng-click="minder.queryCommandState(\'forecolor\') === -1 || minder.execCommand(\'forecolor\', foreColor)" ng-disabled="minder.queryCommandState(\'forecolor\') === -1"></span></div><color-panel minder="minder" class="inline-directive"></color-panel></div>'),e.put("ui/directive/hyperLink/hyperLink.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default hyperlink" title="{{ \'link\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addHyperlink()" ng-disabled="minder.queryCommandState(\'HyperLink\') === -1"></button> <button type="button" class="btn btn-default hyperlink-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'HyperLink\') === -1" title="{{ \'link\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'link\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'link\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addHyperlink()">{{ \'insertlink\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'HyperLink\', null)">{{ \'removelink\' | lang:\'ui\' }}</a></li></ul></div>'),e.put("ui/directive/imageBtn/imageBtn.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default image-btn" title="{{ \'image\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addImage()" ng-disabled="minder.queryCommandState(\'Image\') === -1"></button> <button type="button" class="btn btn-default image-btn-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'Image\') === -1" title="{{ \'image\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'image\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'image\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addImage()">{{ \'insertimage\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'Image\', \'\')">{{ \'removeimage\' | lang:\'ui\' }}</a></li></ul></div>'),e.put("ui/directive/kityminderEditor/kityminderEditor.html",'<div class="minder-editor-container"><div class="top-tab" top-tab="minder" editor="editor" ng-if="minder"></div><div search-box minder="minder" ng-if="minder"></div><div class="minder-editor"></div><div class="km-note" note-editor minder="minder" ng-if="minder"></div><div class="note-previewer" note-previewer ng-if="minder"></div><div class="navigator" navigator minder="minder" ng-if="minder"></div></div>'),e.put("ui/directive/kityminderViewer/kityminderViewer.html",'<div class="minder-editor-container"><div class="minder-viewer"></div><div class="note-previewer" note-previewer ng-if="minder"></div><div class="navigator" navigator minder="minder" ng-if="minder"></div></div>'),e.put("ui/directive/layout/layout.html",'<div class="readjust-layout"><a ng-click="minder.queryCommandState(\'resetlayout\') === -1 || minder.execCommand(\'resetlayout\')" class="btn-wrap" ng-disabled="minder.queryCommandState(\'resetlayout\') === -1"><span class="btn-icon reset-layout-icon"></span> <span class="btn-label">{{ \'resetlayout\' | lang: \'ui/command\' }}</span></a></div>'),
e.put("ui/directive/navigator/navigator.html",'<div class="nav-bar"><div class="nav-btn zoom-in" ng-click="minder.execCommand(\'zoomIn\')" title="{{ \'zoom-in\' | lang : \'ui\' }}" ng-class="{ \'active\' : getZoomRadio(zoom) == 0 }"><div class="icon"></div></div><div class="zoom-pan"><div class="origin" ng-style="{\'transform\': \'translate(0, \' + getHeight(100) + \'px)\'}" ng-click="minder.execCommand(\'zoom\', 100);"></div><div class="indicator" ng-style="{\n             \'transform\': \'translate(0, \' + getHeight(zoom) + \'px)\',\n             \'transition\': \'transform 200ms\'\n             }"></div></div><div class="nav-btn zoom-out" ng-click="minder.execCommand(\'zoomOut\')" title="{{ \'zoom-out\' | lang : \'ui\' }}" ng-class="{ \'active\' : getZoomRadio(zoom) == 1 }"><div class="icon"></div></div><div class="nav-btn hand" ng-click="minder.execCommand(\'hand\')" title="{{ \'hand\' | lang : \'ui\' }}" ng-class="{ \'active\' : minder.queryCommandState(\'hand\') == 1 }"><div class="icon"></div></div><div class="nav-btn camera" ng-click="minder.execCommand(\'camera\', minder.getRoot(), 600);" title="{{ \'camera\' | lang : \'ui\' }}"><div class="icon"></div></div><div class="nav-btn nav-trigger" ng-class="{\'active\' : isNavOpen}" ng-click="toggleNavOpen()" title="{{ \'navigator\' | lang : \'ui\' }}"><div class="icon"></div></div></div><div class="nav-previewer" ng-show="isNavOpen"></div>'),e.put("ui/directive/noteBtn/noteBtn.html",'<div class="btn-group-vertical note-btn-group" dropdown is-open="isopen"><button type="button" class="btn btn-default note-btn" title="{{ \'note\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addNote()" ng-disabled="minder.queryCommandState(\'note\') === -1"></button> <button type="button" class="btn btn-default note-btn-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'note\') === -1" title="{{ \'note\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'note\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'note\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addNote()">{{ \'insertnote\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'note\', null)">{{ \'removenote\' | lang:\'ui\' }}</a></li></ul></div>'),e.put("ui/directive/noteEditor/noteEditor.html",'<div class="panel panel-default" ng-init="noteEditorOpen = false" ng-show="noteEditorOpen"><div class="panel-heading"><h3 class="panel-title">备注</h3><span>（<a class="help" href="https://www.zybuluo.com/techird/note/46064" target="_blank">支持 GFM 语法书写</a>）</span> <i class="close-note-editor glyphicon glyphicon-remove" ng-click="closeNoteEditor()"></i></div><div class="panel-body"><div ng-show="noteEnabled" ui-codemirror="{ onLoad: codemirrorLoaded }" ng-model="noteContent" ui-codemirror-opts="{\n                gfm: true,\n                breaks: true,\n                lineWrapping : true,\n                mode: \'gfm\',\n                dragDrop: false,\n                lineNumbers:true\n             }"></div><p ng-show="!noteEnabled" class="km-note-tips">请选择节点编辑备注</p></div></div>'),e.put("ui/directive/notePreviewer/notePreviewer.html",'<div id="previewer-content" ng-show="showNotePreviewer" ng-style="previewerStyle" ng-bind-html="noteContent"></div>'),e.put("ui/directive/operation/operation.html","<div class=\"km-btn-group operation-group\"><div class=\"km-btn-item edit-node\" ng-disabled=\"minder.queryCommandState('text') === -1\" ng-click=\"minder.queryCommandState('text') === -1 || editNode()\" title=\"{{ 'editnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'editnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item remove-node\" ng-disabled=\"minder.queryCommandState('RemoveNode') === -1\" ng-click=\"minder.queryCommandState('RemoveNode') === -1 || minder.execCommand('RemoveNode');\" title=\"{{ 'removenode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'removenode' | lang:'ui/command' }}</span></div></div>"),e.put("ui/directive/priorityEditor/priorityEditor.html",'<ul class="km-priority tool-group" ng-disabled="commandDisabled"><li class="km-priority-item tool-group-item" ng-repeat="p in priorities" ng-click="commandDisabled || minder.execCommand(\'priority\', p)" ng-class="{ active: commandValue == p }" title="{{ getPriorityTitle(p) }}"><div class="km-priority-icon tool-group-icon priority-{{p}}"></div></li></ul>'),e.put("ui/directive/progressEditor/progressEditor.html",'<ul class="km-progress tool-group" ng-disabled="commandDisabled"><li class="km-progress-item tool-group-item" ng-repeat="p in progresses" ng-click="commandDisabled || minder.execCommand(\'progress\', p)" ng-class="{ active: commandValue == p }" title="{{ getProgressTitle(p) }}"><div class="km-progress-icon tool-group-icon progress-{{p}}"></div></li></ul>'),e.put("ui/directive/resourceEditor/resourceEditor.html",'<div class="resource-editor"><div class="input-group"><input class="form-control" type="text" ng-model="newResourceName" ng-required ng-keypress="$event.keyCode == 13 && addResource(newResourceName)" ng-disabled="!enabled"> <span class="input-group-btn"><button class="btn btn-default" ng-click="addResource(newResourceName)" ng-disabled="!enabled">{{ \'addtag\' | lang:\'ui/command\' }}</button></span></div><div class="resource-dropdown clearfix" id="resource-dropdown"><ul class="km-resource" ng-init="resourceListOpen = false" ng-class="{\'open\': resourceListOpen}"><li ng-repeat="resource in used" ng-disabled="!enabled" ng-blur="blurCB()"><label style="background: {{resourceColor(resource.name)}}"><input type="checkbox" ng-model="resource.selected" ng-disabled="!enabled"> <span>{{resource.name}}</span></label></li></ul><div class="resource-caret" click-anywhere-but-here="resourceListOpen = false" is-active="resourceListOpen" ng-click="resourceListOpen = !resourceListOpen"><span class="caret"></span></div></div></div>'),e.put("ui/directive/searchBox/searchBox.html",'<div id="search" class="search-box clearfix" ng-show="showSearch"><div class="input-group input-group-sm search-input-wrap"><input type="text" id="search-input" class="form-control search-input" ng-model="keyword" ng-keydown="handleKeyDown($event)" aria-describedby="basic-addon2"> <span class="input-group-addon search-addon" id="basic-addon2" ng-show="showTip" ng-bind="\'第 \' + curIndex + \' 条，共 \' + resultNum + \' 条\'"></span></div><div class="btn-group btn-group-sm prev-and-next-btn" role="group"><button type="button" class="btn btn-default" ng-click="doSearch(keyword, \'prev\')"><span class="glyphicon glyphicon-chevron-up"></span></button> <button type="button" class="btn btn-default" ng-click="doSearch(keyword, \'next\')"><span class="glyphicon glyphicon-chevron-down"></span></button></div><div class="close-search" ng-click="exitSearch()"><span class="glyphicon glyphicon-remove"></span></div></div>'),e.put("ui/directive/searchBtn/searchBtn.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default search" title="{{ \'search\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="enterSearch()"></button> <button type="button" class="btn btn-default search-caption dropdown-toggle" ng-click="enterSearch()" title="{{ \'search\' | lang:\'ui\' }}"><span class="caption">{{ \'search\' | lang:\'ui\' }}</span> <span class="sr-only">{{ \'search\' | lang:\'ui\' }}</span></button></div>'),e.put("ui/directive/selectAll/selectAll.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default select" title="{{ \'selectall\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="select[\'all\']()"></button> <button type="button" class="btn btn-default select-caption dropdown-toggle" title="{{ \'selectall\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'selectall\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'selectall\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="item in items"><a href ng-click="select[item]()">{{ \'select\' + item | lang:\'ui\' }}</a></li></ul></div>'),e.put("ui/directive/styleOperator/styleOperator.html",'<div class="style-operator"><a ng-click="minder.queryCommandState(\'clearstyle\') === -1 || minder.execCommand(\'clearstyle\')" class="btn-wrap clear-style" ng-disabled="minder.queryCommandState(\'clearstyle\') === -1"><span class="btn-icon clear-style-icon"></span> <span class="btn-label">{{ \'clearstyle\' | lang: \'ui\' }}</span></a><div class="s-btn-group-vertical"><a class="s-btn-wrap" href ng-click="minder.queryCommandState(\'copystyle\') === -1 || minder.execCommand(\'copystyle\')" ng-disabled="minder.queryCommandState(\'copystyle\') === -1"><span class="s-btn-icon copy-style-icon"></span> <span class="s-btn-label">{{ \'copystyle\' | lang: \'ui\' }}</span></a> <a class="s-btn-wrap paste-style-wrap" href ng-click="minder.queryCommandState(\'pastestyle\') === -1 || minder.execCommand(\'pastestyle\')" ng-disabled="minder.queryCommandState(\'pastestyle\') === -1"><span class="s-btn-icon paste-style-icon"></span> <span class="s-btn-label">{{ \'pastestyle\' | lang: \'ui\' }}</span></a></div></div>'),e.put("ui/directive/templateList/templateList.html",'<div class="dropdown temp-panel" dropdown on-toggle="toggled(open)"><div class="dropdown-toggle current-temp-item" ng-disabled="minder.queryCommandState(\'template\') === -1" dropdown-toggle><a href class="temp-item {{ minder.queryCommandValue(\'template\') }}" title="{{ minder.queryCommandValue(\'template\') | lang: \'template\' }}"></a> <span class="caret"></span></div><ul class="dropdown-menu temp-list"><li ng-repeat="(key, templateObj) in templateList" class="temp-item-wrap"><a ng-click="minder.execCommand(\'template\', key);" class="temp-item {{key}}" ng-class="{ \'temp-item-selected\' : key == minder.queryCommandValue(\'template\') }" title="{{ key | lang: \'template\' }}"></a></li></ul></div>'),e.put("ui/directive/themeList/themeList.html",'<div class="dropdown theme-panel" dropdown><div class="dropdown-toggle theme-item-selected" dropdown-toggle ng-disabled="minder.queryCommandState(\'theme\') === -1"><a href class="theme-item" ng-style="getThemeThumbStyle(minder.queryCommandValue(\'theme\'))" title="{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}">{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}</a> <span class="caret"></span></div><ul class="dropdown-menu theme-list"><li ng-repeat="key in themeKeyList" class="theme-item-wrap"><a ng-click="minder.execCommand(\'theme\', key);" class="theme-item" ng-style="getThemeThumbStyle(key)" title="{{ key | lang: \'theme\'; }}">{{ key | lang: \'theme\'; }}</a></li></ul></div>'),e.put("ui/directive/topTab/topTab.html",'<tabset><tab heading="{{ \'idea\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'idea\')" select="setCurTab(\'idea\')"><undo-redo editor="editor"></undo-redo><append-node minder="minder"></append-node><arrange minder="minder"></arrange><operation minder="minder"></operation><hyper-link minder="minder"></hyper-link><image-btn minder="minder"></image-btn><note-btn minder="minder"></note-btn><priority-editor minder="minder"></priority-editor><progress-editor minder="minder"></progress-editor><resource-editor minder="minder"></resource-editor></tab><tab heading="{{ \'appearence\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'appearance\')" select="setCurTab(\'appearance\')"><template-list minder="minder" class="inline-directive"></template-list><theme-list minder="minder"></theme-list><layout minder="minder" class="inline-directive"></layout><style-operator minder="minder" class="inline-directive"></style-operator><font-operator minder="minder" class="inline-directive"></font-operator></tab><tab heading="{{ \'view\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'view\')" select="setCurTab(\'view\')"><expand-level minder="minder"></expand-level><select-all minder="minder"></select-all><search-btn minder="minder"></search-btn></tab></tabset>'),e.put("ui/directive/undoRedo/undoRedo.html",'<div class="km-btn-group do-group"><div class="km-btn-item undo" ng-disabled="editor.history.hasUndo() == false" ng-click="editor.history.hasUndo() == false || editor.history.undo();" title="{{ \'undo\' | lang:\'ui\' }}"><i class="km-btn-icon"></i></div><div class="km-btn-item redo" ng-disabled="editor.history.hasRedo() == false" ng-click="editor.history.hasRedo() == false || editor.history.redo()" title="{{ \'redo\' | lang:\'ui\' }}"><i class="km-btn-icon"></i></div></div>'),e.put("ui/dialog/hyperlink/hyperlink.tpl.html",'<div class="modal-header"><h3 class="modal-title">链接</h3></div><div class="modal-body"><form><div class="form-group" id="link-url-wrap" ng-class="{true: \'has-success\', false: \'has-error\'}[urlPassed]"><label for="link-url">链接地址：</label><input type="text" class="form-control" ng-model="url" ng-blur="urlPassed = R_URL.test(url)" ng-focus="this.value = url" ng-keydown="shortCut($event)" id="link-url" placeholder="必填：以 http(s):// 或 ftp:// 开头"></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="link-title">提示文本：</label><input type="text" class="form-control" ng-model="title" ng-blur="titlePassed = true" id="link-title" placeholder="选填：鼠标在链接上悬停时提示的文本"></div></form></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">确定</button> <button class="btn btn-warning" ng-click="cancel()">取消</button></div>'),e.put("ui/dialog/imExportNode/imExportNode.tpl.html",'<div class="modal-header"><h3 class="modal-title">{{ title }}</h3></div><div class="modal-body"><textarea type="text" class="form-control single-input" rows="8" ng-keydown="shortCut($event);" ng-model="value" ng-readonly="type === \'export\'">\n    </textarea></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()" ng-disabled="type === \'import\' && value == \'\'">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),e.put("ui/dialog/image/image.tpl.html",'<div class="modal-header"><h3 class="modal-title">图片</h3></div><div class="modal-body"><tabset><tab heading="图片搜索"><form class="form-inline"><div class="form-group"><label for="search-keyword">关键词：</label><input type="text" class="form-control" ng-model="data.searchKeyword2" id="search-keyword" placeholder="请输入搜索的关键词"></div><button class="btn btn-primary" ng-click="searchImage()">百度一下</button></form><div class="search-result" id="search-result"><ul><li ng-repeat="image in list" id="{{ \'img-item\' + $index }}" ng-class="{\'selected\' : isSelected}" ng-click="selectImage($event)"><img id="{{ \'img-\' + $index }}" ng-src="{{ image.src || \'\' }}" alt="{{ image.title }}" onerror="this.parentNode.removeChild(this)"> <span>{{ image.title }}</span></li></ul></div></tab><tab heading="外链图片"><form><div class="form-group" ng-class="{true: \'has-success\', false: \'has-error\'}[urlPassed]"><label for="image-url">链接地址：</label><input type="text" class="form-control" ng-model="data.url" ng-blur="urlPassed = data.R_URL.test(data.url)" ng-focus="this.value = data.url" ng-keydown="shortCut($event)" id="image-url" placeholder="必填：以 http(s):// 开头"></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="image-title">提示文本：</label><input type="text" class="form-control" ng-model="data.title" ng-blur="titlePassed = true" id="image-title" placeholder="选填：鼠标在图片上悬停时提示的文本"></div><div class="form-group"><label for="image-preview">图片预览：</label><img class="image-preview" id="image-preview" ng-src="{{ data.url }}" alt="{{ data.title }}"></div></form></tab><tab heading="上传图片" active="true"><form><div class="form-group"><input type="file" name="upload-image" id="upload-image" class="upload-image" accept=".jpg,.JPG,jpeg,JPEG,.png,.PNG,.gif,.GIF" onchange="angular.element(this).scope().uploadImage()"><label for="upload-image" class="btn btn-primary"><span>选择文件&hellip;</span></label></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="image-title">提示文本：</label><input type="text" class="form-control" ng-model="data.title" ng-blur="titlePassed = true" id="image-title" placeholder="选填：鼠标在图片上悬停时提示的文本"></div><div class="form-group"><label for="image-preview">图片预览：</label><img class="image-preview" id="image-preview" ng-src="{{ data.url }}" title="{{ data.title }}" alt="{{ data.title }}"></div></form></tab></tabset></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">确定</button> <button class="btn btn-warning" ng-click="cancel()">取消</button></div>')}]),angular.module("kityminderEditor").service("commandBinder",function(){return{bind:function(e,t,n){e.on("interactchange",function(){n.commandDisabled=-1===e.queryCommandState(t),n.commandValue=e.queryCommandValue(t),n.$apply()})}}}),angular.module("kityminderEditor").provider("config",function(){this.config={ctrlPanelMin:250,ctrlPanelWidth:parseInt(window.localStorage.__dev_minder_ctrlPanelWidth)||250,dividerWidth:3,defaultLang:_lang_default,zoom:[10,20,30,50,80,100,120,150,200],imageUpload:"server/imageUpload.php"},this.set=function(e,t){var n=Object.keys(this.config),i={};for(var r in"object"==typeof e?i=e:i[e]=t,i){if(!i.hasOwnProperty(r)||-1===n.indexOf(r))return console.error("Unsupported config key: ",e,", please choose in :",n.join(", ")),!1;this.config[r]=i[r]}return!0},this.$get=function(){var e=this;return{get:function(t){return 0===arguments.length?e.config:e.config.hasOwnProperty(t)?e.config[t]:(console.warn("Missing config key pair for : ",t),"")}}}}),angular.module("kityminderEditor").service("lang.pack",function(){return _lang_pack}),angular.module("kityminderEditor").service("memory",function(){function e(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}return{get:function(e){var t=window.localStorage.getItem(e);return JSON.parse(t)},set:function(t,n){try{return window.localStorage.setItem(t,JSON.stringify(n)),!0}catch(t){if(e(t))return!1}},remove:function(e){var t=window.localStorage.getItem(e);return window.localStorage.removeItem(e),t},clear:function(){window.localStorage.clear()}}}),angular.module("kityminderEditor").service("minder.service",function(){function e(e){n.push(e)}function t(){n.forEach(function(e){e.apply(this,arguments)})}var n=[];return{registerEvent:e,executeCallback:t}}),angular.module("kityminderEditor").service("resourceService",["$document",function(e){var t=null;this.open=function(r){t||(e.bind("click",n),e.bind("keydown",i)),t&&t!==r&&(t.resourceListOpen=!1),t=r},this.close=function(r){t===r&&(t=null,e.unbind("click",n),e.unbind("keydown",i))};var n=function(e){if(t){var n=t.getToggleElement();e&&n&&n[0].contains(e.target)||t.$apply(function(){console.log("to close the resourcelist"),t.resourceListOpen=!1})}},i=function(e){27===e.which&&(t.focusToggleElement(),n())}}]),angular.module("kityminderEditor").service("revokeDialog",["$modal","minder.service",function(e,t){return t.registerEvent(function(){var t=window.minder,n=window.editor,i=n.hotbox.getParentFSM();t.on("importNodeData",function(){i.jump("modal","import-text-modal");var r=e.open({animation:!0,templateUrl:"ui/dialog/imExportNode/imExportNode.tpl.html",controller:"imExportNode.ctrl",size:"md",resolve:{title:function(){return _lang_pack[_lang_default].hotbox.importnode},defaultValue:function(){return""},type:function(){return"import"}}});r.result.then(function(e){try{t.Text2Children(t.getSelectedNode(),e)}catch(e){alert(e)}i.jump("normal","import-text-finish"),n.receiver.selectAll()},function(){i.jump("normal","import-text-finish"),n.receiver.selectAll()})}),t.on("exportNodeData",function(){i.jump("modal","export-text-modal");var r=e.open({animation:!0,templateUrl:"ui/dialog/imExportNode/imExportNode.tpl.html",controller:"imExportNode.ctrl",size:"md",resolve:{title:function(){return _lang_pack[_lang_default].hotbox.exportnode},defaultValue:function(){var e=t.getSelectedNode(),n=window.kityminder.data.getRegisterProtocol("text").Node2Text;return n(e)},type:function(){return"export"}}});r.result.then(function(e){i.jump("normal","export-text-finish"),n.receiver.selectAll()},function(){i.jump("normal","export-text-finish"),n.receiver.selectAll()})})}),{}}]),angular.module("kityminderEditor").service("server",["config","$http",function(e,t){return{uploadImage:function(n){var i=e.get("imageUpload"),r=new FormData;return r.append("upload_file",n),t.post(i,r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}}}]),angular.module("kityminderEditor").service("valueTransfer",function(){return{}}),angular.module("kityminderEditor").filter("commandState",function(){return function(e,t){return e.queryCommandState(t)}}).filter("commandValue",function(){return function(e,t){return e.queryCommandValue(t)}}),angular.module("kityminderEditor").filter("lang",["config","lang.pack",function(e,t){return function(n,i){var r=e.get("defaultLang");if(null==t[r])return"未发现对应语言包，请检查 lang.xxx.service.js!";var o=t[r];return i.split("/").forEach(function(e,t){o=o[e]}),o[n]||null}}]),angular.module("kityminderEditor").controller("hyperlink.ctrl",["$scope","$modalInstance","link",function(e,t,n){var i="^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$";e.R_URL=new RegExp(i,"i"),e.url=n.url||"",e.title=n.title||"",setTimeout(function(){var t=$("#link-url");t.focus(),t[0].setSelectionRange(0,e.url.length)},30),e.shortCut=function(t){t.stopPropagation(),13==t.keyCode?e.ok():27==t.keyCode&&e.cancel()},e.ok=function(){if(e.R_URL.test(e.url))t.close({url:e.url,title:e.title});else{e.urlPassed=!1;var n=$("#link-url");n.focus(),n[0].setSelectionRange(0,e.url.length)}editor.receiver.selectAll()},e.cancel=function(){t.dismiss("cancel"),editor.receiver.selectAll()}}]),angular.module("kityminderEditor").controller("imExportNode.ctrl",["$scope","$modalInstance","title","defaultValue","type",function(e,t,n,i,r){function o(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function a(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}e.title=n,e.value=i,e.type=r,e.ok=function(){""!=e.value&&(t.close(e.value),editor.receiver.selectAll())},e.cancel=function(){t.dismiss("cancel"),editor.receiver.selectAll()},setTimeout(function(){$(".single-input").focus(),$(".single-input")[0].setSelectionRange(0,i.length)},30),e.shortCut=function(t){if(t.stopPropagation(),27==t.keyCode&&e.cancel(),8==t.keyCode&&"export"==r&&t.preventDefault(),9==t.keyCode){t.preventDefault();var n=t.target,i=o(n),l=n.value;n.value=l.substr(0,i)+"\t"+l.substr(i),a(n,i+1)}}}]),angular.module("kityminderEditor").controller("image.ctrl",["$http","$scope","$modalInstance","image","server",function(e,t,n,i,r){function o(){var n=t.data.searchKeyword2,i=new Date,r="http://image.baidu.com/search/acjson?tn=resultjson_com&ipn=rj&ct=201326592&fp=result&queryWord="+n+"&cl=2&lm=-1&ie=utf-8&oe=utf-8&st=-1&ic=0&word="+n+"&face=0&istype=2&nc=1&pn=60&rn=60&gsm=3c&"+i.getTime()+"=&callback=JSON_CALLBACK";return e.jsonp(r)}t.data={list:[],url:i.url||"",title:i.title||"",R_URL:/^https?\:\/\/\w+/},setTimeout(function(){var e=$("#image-url");e.focus(),e[0].setSelectionRange(0,t.data.url.length)},300),t.searchImage=function(){t.list=[],o().success(function(e){if(e&&e.data)for(var n=0;n<e.data.length;n++)e.data[n].objURL&&t.list.push({title:e.data[n].fromPageTitleEnc,src:e.data[n].middleURL,url:e.data[n].middleURL})}).error(function(){})},t.selectImage=function(e){var n=$("#img-item"+this.$index),i=$("#img-"+this.$index);n.siblings(".selected").removeClass("selected"),n.addClass("selected"),t.data.url=i.attr("src"),t.data.title=i.attr("alt")},t.uploadImage=function(){var e=$("#upload-image");if(e.val()){if(/^.*\.(jpg|JPG|jpeg|JPEG|gif|GIF|png|PNG)$/.test(e.val())){var n=e[0].files[0];return r.uploadImage(n).then(function(e){var n=e.data;0===n.errno&&(t.data.url=n.data.url)})}alert("后缀只能是 jpg、gif 及 png")}},t.shortCut=function(e){e.stopPropagation(),13==e.keyCode?t.ok():27==e.keyCode&&t.cancel()},t.ok=function(){if(t.data.R_URL.test(t.data.url))n.close({url:t.data.url,title:t.data.title});else{t.urlPassed=!1;var e=$("#image-url");e&&(e.focus(),e[0].setSelectionRange(0,t.data.url.length))}editor.receiver.selectAll()},t.cancel=function(){n.dismiss("cancel"),editor.receiver.selectAll()}}]),angular.module("kityminderEditor").directive("appendNode",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/appendNode/appendNode.html",scope:{minder:"="},replace:!0,link:function(t){function n(){var e=editor.receiver.element,t=editor.fsm,n=editor.receiver;e.innerText=i.queryCommandValue("text"),t.jump("input","input-request"),n.selectAll()}var i=t.minder;e.bind(i,"appendchildnode",t),t.execCommand=function(e){i.execCommand(e,"分支主题"),n()}}}}]),angular.module("kityminderEditor").directive("arrange",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/arrange/arrange.html",scope:{minder:"="},replace:!0,link:function(e){e.minder}}}]),angular.module("kityminderEditor").directive("colorPanel",function(){return{restrict:"E",templateUrl:"ui/directive/colorPanel/colorPanel.html",scope:{minder:"="},replace:!0,link:function(e){var t=e.minder;t.getThemeItems();e.$on("colorPicked",function(n,i){n.stopPropagation(),e.bgColor=i,t.execCommand("background",i)}),e.setDefaultBg=function(){var e=t.getSelectedNode(),n=t.getNodeStyle(e,"background");return"object"==typeof n?n.toHEX():n},e.bgColor=e.setDefaultBg()||"#fff"}}}),angular.module("kityminderEditor").directive("expandLevel",function(){return{restrict:"E",templateUrl:"ui/directive/expandLevel/expandLevel.html",scope:{minder:"="},replace:!0,link:function(e){e.levels=[1,2,3,4,5,6]}}}),angular.module("kityminderEditor").directive("fontOperator",function(){return{restrict:"E",templateUrl:"ui/directive/fontOperator/fontOperator.html",scope:{minder:"="},replace:!0,link:function(e){var t=e.minder;t.getThemeItems();e.fontSizeList=[10,12,16,18,24,32,48],e.fontFamilyList=[{name:"宋体",val:"宋体,SimSun"},{name:"微软雅黑",val:"微软雅黑,Microsoft YaHei"},{name:"楷体",val:"楷体,楷体_GB2312,SimKai"},{name:"黑体",val:"黑体, SimHei"},{name:"隶书",val:"隶书, SimLi"},{name:"Andale Mono",val:"andale mono"},{name:"Arial",val:"arial,helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"Comic Sans Ms",val:"comic sans ms"},{name:"Impact",val:"impact,chicago"},{name:"Times New Roman",val:"times new roman"},{name:"Sans-Serif",val:"sans-serif"}],e.$on("colorPicked",function(n,i){n.stopPropagation(),e.foreColor=i,t.execCommand("forecolor",i)}),e.setDefaultColor=function(){var e=t.getSelectedNode(),n=t.getNodeStyle(e,"color");return"object"==typeof n?n.toHEX():n},e.foreColor=e.setDefaultColor()||"#000",e.getFontfamilyName=function(t){let n=_lang_pack[_lang_default].ui.fontfamily;return e.fontFamilyList.forEach(function(e,i,r){if(e.val===t)return n=e.name,""}),n},e.getFontSize=function(e){let t=_lang_pack[_lang_default].ui.fontsize;return null==e&&(e=t),e}}}}),angular.module("kityminderEditor").directive("hyperLink",["$modal",function(e){return{restrict:"E",templateUrl:"ui/directive/hyperLink/hyperLink.html",scope:{minder:"="},replace:!0,link:function(t){var n=t.minder;t.addHyperlink=function(){var t=n.queryCommandValue("HyperLink"),i=e.open({animation:!0,templateUrl:"ui/dialog/hyperlink/hyperlink.tpl.html",controller:"hyperlink.ctrl",size:"md",resolve:{link:function(){return t}}});i.result.then(function(e){n.execCommand("HyperLink",e.url,e.title||"")})}}}}]),angular.module("kityminderEditor").directive("imageBtn",["$modal",function(e){return{restrict:"E",templateUrl:"ui/directive/imageBtn/imageBtn.html",scope:{minder:"="},replace:!0,link:function(t){var n=t.minder;t.addImage=function(){var t=n.queryCommandValue("image"),i=e.open({animation:!0,templateUrl:"ui/dialog/image/image.tpl.html",controller:"image.ctrl",size:"md",resolve:{image:function(){return t}}});i.result.then(function(e){n.execCommand("image",e.url,e.title||"")})}}}}]),angular.module("kityminderEditor").directive("kityminderEditor",["config","minder.service","revokeDialog",function(e,t,n){return{restrict:"EA",templateUrl:"ui/directive/kityminderEditor/kityminderEditor.html",replace:!0,scope:{onInit:"&"},link:function(n,i,r){function o(e,i){n.onInit({editor:e,minder:i}),t.executeCallback()}var a=i.children(".minder-editor")[0];if("undefined"!=typeof seajs)seajs.config({base:"./src"}),define("demo",function(t){var i=t("editor"),r=window.editor=new i(a);window.localStorage.__dev_minder_content&&r.minder.importJson(JSON.parse(window.localStorage.__dev_minder_content)),r.minder.on("contentchange",function(){window.localStorage.__dev_minder_content=JSON.stringify(r.minder.exportJson())}),window.minder=window.km=r.minder,n.editor=r,n.minder=minder,n.config=e.get(),n.$apply(),o(r,minder)}),seajs.use("demo");else if(window.kityminder&&window.kityminder.Editor){var l=new kityminder.Editor(a);window.editor=n.editor=l,window.minder=n.minder=l.minder,n.config=e.get(),o(l,l.minder)}}}}]),angular.module("kityminderEditor").directive("kityminderViewer",["config","minder.service",function(e,t){return{restrict:"EA",templateUrl:"ui/directive/kityminderViewer/kityminderViewer.html",replace:!0,scope:{onInit:"&"},link:function(e,n,i){function r(n,i){e.onInit({editor:n,minder:i}),t.executeCallback()}var o=n.children(".minder-viewer")[0];if(window.kityminder&&window.kityminder.Editor){var a=new kityminder.Editor(o);window.editor=e.editor=a,window.minder=e.minder=a.minder,r(a,a.minder)}}}}]),angular.module("kityminderEditor").directive("layout",function(){return{restrict:"E",templateUrl:"ui/directive/layout/layout.html",scope:{minder:"="},replace:!0,link:function(e){}}}),angular.module("kityminderEditor").directive("navigator",["memory","config",function(e,t){return{restrict:"A",templateUrl:"ui/directive/navigator/navigator.html",scope:{minder:"="},link:function(n){function i(){minder.on("layout layoutallfinish",l),minder.on("viewchange",c)}function r(){minder.off("layout layoutallfinish",l),minder.off("viewchange",c)}function o(e){switch(e){case"tianpan":case"tianpan-compact":return function(e,t,n,i,r){var o=i>>1;e.push("M",t,n+o,"a",o,o,0,1,1,0,.01,"z")};default:return function(e,t,n,i,r){e.push("M",t,n,"h",i,"v",r,"h",-i,"z")}}}function a(){function e(e,t){var n=f;e.x=-e.x,e.y=-e.y;var i=minder.getPaper().getViewPortMatrix();n=i.transformBox(n);var r=e.offset(n.width/2,n.height/2);minder.getViewDragger().moveTo(r,t)}var t=!1;s.on("mousedown",function(n){t=!0,e(n.getPosition("top"),200),d.addClass("grab")}),s.on("mousemove",function(n){t&&e(n.getPosition("top"))}),$(window).on("mouseup",function(){t=!1,d.removeClass("grab")})}function l(){var e=minder.getRenderContainer().getBoundaryBox();g=e;var t=30;s.setViewBox(e.x-t-.5,e.y-t-.5,e.width+2*t+1,e.height+2*t+1);var n=[],i=[];minder.getRoot().traverse(function(e){var t=e.getLayoutBox();v(n,t.x,t.y,t.width,t.height),e.getConnection()&&e.parent&&e.parent.isExpanded()&&i.push(e.getConnection().getPathData())}),s.setStyle("background",minder.getStyle("background")),n.length?u.fill(minder.getStyle("root-background")).setPathData(n):u.setPathData(null),
i.length?m.stroke(minder.getStyle("connect-color"),"0.5%").setPathData(i):m.setPathData(null),c()}function c(){f=minder.getViewDragger().getView(),p.setBox(f.intersect(g))}minder.setDefaultOptions({zoom:t.get("zoom")}),n.isNavOpen=!e.get("navigator-hidden"),n.getZoomRadio=function(e){var t=minder.getOption("zoom"),n=t[0],i=t[t.length-1],r=i-n;return 1-(e-n)/r},n.getHeight=function(e){var t=$(".zoom-pan").height();return n.getZoomRadio(e)*t},n.zoom=100,minder.on("zoom",function(e){n.zoom=e.zoom}),n.toggleNavOpen=function(){n.isNavOpen=!n.isNavOpen,e.set("navigator-hidden",!n.isNavOpen),n.isNavOpen?(i(),l(),c()):r()},setTimeout(function(){n.isNavOpen?(i(),l(),c()):r()},0);var d=$(".nav-previewer"),s=new kity.Paper(d[0]),u=s.put(new kity.Path),m=s.put(new kity.Path),p=s.put(new kity.Rect(100,100).stroke("red","1%")),g=new kity.Box,f=new kity.Box,v=o(minder.getTheme());minder.on("themechange",function(e){v=o(e.theme)}),a()}}}]),angular.module("kityminderEditor").directive("noteBtn",["valueTransfer",function(e){return{restrict:"E",templateUrl:"ui/directive/noteBtn/noteBtn.html",scope:{minder:"="},replace:!0,link:function(t){t.minder;t.addNote=function(){e.noteEditorOpen=!0}}}}]),angular.module("kityminderEditor").directive("noteEditor",["valueTransfer",function(e){return{restrict:"A",templateUrl:"ui/directive/noteEditor/noteEditor.html",scope:{minder:"="},replace:!0,controller:["$scope",function(t){function n(){var e=t.noteEnabled=-1!=r.queryCommandState("note"),n=r.queryCommandValue("note")||"";e&&(t.noteContent=n),o=!0,t.$apply(),o=!1}var i,r=t.minder,o=!1;t.codemirrorLoaded=function(e){i=t.cmEditor=e,e.setSize("100%","100%")},t.$watch("noteContent",function(e){var t=-1!=r.queryCommandState("note");e&&t&&!o&&r.execCommand("note",e),setTimeout(function(){i.refresh()})});var a=function(){return e.noteEditorOpen};t.$watch(a,function(n,r){n&&setTimeout(function(){i.refresh(),i.focus()}),t.noteEditorOpen=e.noteEditorOpen},!0),t.closeNoteEditor=function(){e.noteEditorOpen=!1,editor.receiver.selectAll()},r.on("interactchange",n)}]}}]),angular.module("kityminderEditor").directive("notePreviewer",["$sce","valueTransfer",function(e,t){return{restrict:"A",templateUrl:"ui/directive/notePreviewer/notePreviewer.html",link:function(t,n){function i(n,i){var r=n.getRenderer("NoteIconRenderer").getRenderShape(),o=r.getRenderBox("screen"),d=n.getData("note");l[0].scrollTop=0;var s=marked(d);i&&(s=s.replace(new RegExp("("+i+")","ig"),'<span class="highlight">$1</span>')),t.noteContent=e.trustAsHtml(s),t.$apply();var u=$(a[0]).width(),m=$(a[0]).height(),p=$(l).outerWidth(),g=$(l).outerHeight(),f=o.cx-p/2-a[0].offsetLeft,v=o.bottom+10-a[0].offsetTop;f<0&&(f=10),f+p>u&&(f=o.left-p-10-a[0].offsetLeft),v+g>m&&(v=o.top-g-10-a[0].offsetTop),t.previewerStyle={left:Math.round(f)+"px",top:Math.round(v)+"px"},t.showNotePreviewer=!0;var h=l[0].querySelector(".highlight");h&&h.scrollIntoView(),c=!0,t.$apply()}var r,o=t.minder,a=n.parent(),l=n.children();t.showNotePreviewer=!1,marked.setOptions({gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),o.on("shownoterequest",function(e){r=setTimeout(function(){i(e.node,e.keyword)},300)}),o.on("hidenoterequest",function(){clearTimeout(r),t.showNotePreviewer=!1});var c=!1;$(document).on("mousedown mousewheel DOMMouseScroll",function(){c&&(t.showNotePreviewer=!1,t.$apply())}),n.on("mousedown mousewheel DOMMouseScroll",function(e){e.stopPropagation()})}}}]),angular.module("kityminderEditor").directive("operation",function(){return{restrict:"E",templateUrl:"ui/directive/operation/operation.html",scope:{minder:"="},replace:!0,link:function(e){e.editNode=function(){var e=editor.receiver.element,t=editor.fsm,n=editor.receiver;e.innerText=minder.queryCommandValue("text"),t.jump("input","input-request"),n.selectAll()}}}}),angular.module("kityminderEditor").directive("priorityEditor",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/priorityEditor/priorityEditor.html",scope:{minder:"="},replace:!0,link:function(t){for(var n=t.minder,i=[],r=0;r<10;r++)i.push(r);e.bind(n,"priority",t),t.priorities=i,t.getPriorityTitle=function(e){switch(e){case 0:return _lang_pack[_lang_default].ui.removepriority;default:return _lang_pack[_lang_default].ui.priority+" "+e}}}}}]),angular.module("kityminderEditor").directive("progressEditor",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/progressEditor/progressEditor.html",scope:{minder:"="},replace:!0,link:function(t){for(var n=t.minder,i=[],r=0;r<10;r++)i.push(r);e.bind(n,"progress",t),t.progresses=i,t.getProgressTitle=function(e){switch(e){case 0:return _lang_pack[_lang_default].ui.progress.p0;case 1:return _lang_pack[_lang_default].ui.progress.p1;case 9:return _lang_pack[_lang_default].ui.progress.p9;default:return _lang_pack[_lang_default].ui.progress["p"+e]}}}}}]),angular.module("kityminderEditor").directive("resourceEditor",function(){return{restrict:"E",templateUrl:"ui/directive/resourceEditor/resourceEditor.html",scope:{minder:"="},replace:!0,controller:["$scope",function(e){var t=e.minder,n=!1;t.on("interactchange",function(){var i=e.enabled=-1!=t.queryCommandState("resource"),r=i?t.queryCommandValue("resource"):[],o=t.getUsedResource().map(function(e){return{name:e,selected:r.indexOf(e)>-1}});e.used=o,n=!0,e.$apply(),n=!1}),e.$watch("used",function(e){if(-1!=t.queryCommandState("resource")&&e){var i=e.filter(function(e){return e.selected}).map(function(e){return e.name});if(n)return;t.execCommand("resource",i)}},!0),e.resourceColor=function(e){return t.getResourceColor(e).toHEX()},e.addResource=function(n){var i=t.queryCommandValue("resource");n&&/\S/.test(n)&&(-1==i.indexOf(n)&&e.used.push({name:n,selected:!0}),e.newResourceName=null)}}]}}).directive("clickAnywhereButHere",["$document",function(e){return{link:function(t,n,i){var r=function(e){var n=$("#resource-dropdown").has(e.target).length>0,r=$("#resource-dropdown")==e.target,o=n||r;o||t.$apply(i.clickAnywhereButHere)};t.$watch(i.isActive,function(t,n){t!==n&&1==t?e.bind("click",r):t!==n&&0==t&&e.unbind("click",r)})}}}]),angular.module("kityminderEditor").directive("searchBox",function(){return{restrict:"A",templateUrl:"ui/directive/searchBox/searchBox.html",scope:{minder:"="},replace:!0,controller:["$scope",function(e){function t(t){if(13==t.keyCode){var i=t.shiftKey?"prev":"next";a(e.keyword,i)}27==t.keyCode&&n()}function n(){$("#search-input").blur(),e.showSearch=!1,l.fire("hidenoterequest"),c.receiver.selectAll()}function i(){e.showSearch=!0,setTimeout(function(){$("#search-input").focus()},10),e.keyword&&$("#search-input")[0].setSelectionRange(0,e.keyword.length)}function r(){d=[],l.getRoot().traverse(function(e){d.push(e)})}function o(e){s=[];for(var t=0;t<d.length;t++){var n=d[t],i=n.getText().toLowerCase();-1!=i.indexOf(e)&&s.push({node:n});var r=n.getData("note");r&&-1!=r.toLowerCase().indexOf(e)&&s.push({node:n,keyword:e})}}function a(t,n){if(e.showTip=!1,l.fire("hidenoterequest"),t&&/\S/.exec(t)){e.showTip=!0,e.curIndex=0,e.resultNum=0,t=t.toLowerCase();var i=a.lastKeyword!=t;if(a.lastKeyword=t,i&&o(t),e.resultNum=s.length,s.length){var r=i?0:("next"===n?a.lastIndex+1:a.lastIndex-1)||0;function c(e,t){l.execCommand("camera",e,50),setTimeout(function(){l.select(e,!0),e.isExpanded()||l.execCommand("expand",!0),t&&l.fire("shownoterequest",{node:e,keyword:t})},60)}r=(s.length+r)%s.length,c(s[r].node,s[r].keyword),a.lastIndex=r,e.curIndex=r+1}}else $("#search-input").focus()}var l=e.minder,c=window.editor;e.handleKeyDown=t,e.doSearch=a,e.exitSearch=n,e.showTip=!1,e.showSearch=!1,$("body").on("keydown",function(t){70!=t.keyCode||!t.ctrlKey&&!t.metaKey||t.shiftKey||(i(),e.$apply(),t.preventDefault())}),l.on("searchNode",function(){i()});var d=[],s=[];l.on("contentchange",r),r()}]}}),angular.module("kityminderEditor").directive("searchBtn",function(){return{restrict:"E",templateUrl:"ui/directive/searchBtn/searchBtn.html",scope:{minder:"="},replace:!0,link:function(e){function t(){minder.fire("searchNode")}e.enterSearch=t}}}),angular.module("kityminderEditor").directive("selectAll",function(){return{restrict:"E",templateUrl:"ui/directive/selectAll/selectAll.html",scope:{minder:"="},replace:!0,link:function(e){var t=e.minder;e.items=["revert","siblings","level","path","tree"],e.select={all:function(){var e=[];t.getRoot().traverse(function(t){e.push(t)}),t.select(e,!0),t.fire("receiverfocus")},revert:function(){var e=t.getSelectedNodes(),n=[];t.getRoot().traverse(function(t){-1==e.indexOf(t)&&n.push(t)}),t.select(n,!0),t.fire("receiverfocus")},siblings:function(){var e=t.getSelectedNodes(),n=[];e.forEach(function(e){e.parent&&e.parent.children.forEach(function(e){-1==n.indexOf(e)&&n.push(e)})}),t.select(n,!0),t.fire("receiverfocus")},level:function(){var e=t.getSelectedNodes().map(function(e){return e.getLevel()}),n=[];t.getRoot().traverse(function(t){-1!=e.indexOf(t.getLevel())&&n.push(t)}),t.select(n,!0),t.fire("receiverfocus")},path:function(){var e=t.getSelectedNodes(),n=[];e.forEach(function(e){for(;e&&-1==n.indexOf(e);)n.push(e),e=e.parent}),t.select(n,!0),t.fire("receiverfocus")},tree:function(){var e=t.getSelectedNodes(),n=[];e.forEach(function(e){e.traverse(function(e){-1==n.indexOf(e)&&n.push(e)})}),t.select(n,!0),t.fire("receiverfocus")}}}}}),angular.module("kityminderEditor").directive("styleOperator",function(){return{restrict:"E",templateUrl:"ui/directive/styleOperator/styleOperator.html",scope:{minder:"="},replace:!0}}),angular.module("kityminderEditor").directive("templateList",function(){return{restrict:"E",templateUrl:"ui/directive/templateList/templateList.html",scope:{minder:"="},replace:!0,link:function(e){e.templateList=kityminder.Minder.getTemplateList()}}}),angular.module("kityminderEditor").directive("themeList",function(){return{restrict:"E",templateUrl:"ui/directive/themeList/themeList.html",replace:!0,link:function(e){var t=kityminder.Minder.getThemeList();e.getThemeThumbStyle=function(e){var n=t[e];if(n){var i={color:n["root-color"],"border-radius":n["root-radius"]/2};return n["root-background"]&&(i.background=n["root-background"].toString()),i}},e.themeKeyList=["classic","classic-compact","fresh-blue","fresh-blue-compat","fresh-green","fresh-green-compat","fresh-pink","fresh-pink-compat","fresh-purple","fresh-purple-compat","fresh-red","fresh-red-compat","fresh-soil","fresh-soil-compat","snow","snow-compact","tianpan","tianpan-compact","fish","wire"]}}}),angular.module("kityminderEditor").directive("topTab",function(){return{restrict:"A",templateUrl:"ui/directive/topTab/topTab.html",scope:{minder:"=topTab",editor:"="},link:function(e){function t(){var e=$(".tab-content"),t=$(".minder-editor");e.animate({height:0,display:"none"}),t.animate({top:"32px"})}function n(){var e=$(".tab-content"),t=$(".minder-editor");e.animate({height:"60px",display:"block"}),t.animate({top:"92px"})}var i=!1,r=!0,o=!0;e.setCurTab=function(e){setTimeout(function(){i=!0,"idea"!=e&&(r=!1)})},e.toggleTopTab=function(){setTimeout(function(){i&&!r||(r=!1,o?t():n(),o=!o),i=!1})}}}}),angular.module("kityminderEditor").directive("undoRedo",function(){return{restrict:"E",templateUrl:"ui/directive/undoRedo/undoRedo.html",scope:{editor:"="},replace:!0,link:function(e){}}}),e("expose-editor")})();